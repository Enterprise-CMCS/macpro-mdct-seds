service: data-deployment

frameworkVersion: "2"

plugins:
  - serverless-plugin-scripts
  - serverless-dynamodb-seed
  - serverless-stack-termination-protection

provider:
  name: aws
  region: us-east-1

custom:
  stage: ${opt:stage, self:provider.stage}
  region: ${opt:region, self:provider.region}
  iamPath: ${ssm:/configuration/${self:custom.stage}/iam/path~true, ssm:/configuration/default/iam/path~true, "/"}
  iamPermissionsBoundaryPolicy: ${ssm:/configuration/${self:custom.stage}/iam/permissionsBoundaryPolicy~true, ssm:/configuration/default/iam/permissionsBoundaryPolicy~true, ""}
  serverlessTerminationProtection:
    stages: # This is a list of common names for important envs that should not be destroyed.  You can remove the stage names your project doesn't use; this list is meant to be inclusive.
      - master
      - val
      - production
      - develop
      - main
      - impl
      - val
      - prod
  seed:
    forms:
      table: ${self:custom.stage}-forms
      sources: [../../src/database/initial_data_load/forms.json]

  scripts:
    hooks:
      deploy:finalize: |
        sls --stage ${self:custom.stage} dynamodb:seed
